async function moduleInitFunction(require,exports={}){function wordRegexp(words){return new RegExp("^(("+words.join(")|(")+"))\\b")}// Tokenizers
function tokenBase(stream,state){if(stream.eatSpace())return null;// Brackets
if(stream.match(/[{}]/))return"bracket";// Special [] keyword
if(stream.match("[]"))return"keyword";// Operators
if(stream.match(tripleOperators)||stream.match(doubleOperators))return"operator";// Atoms
if(stream.match(atoms))return"atom";// Opening keywords
var matched=stream.match(openingKeywords);if(matched)return state.doInCurrentLine?state.doInCurrentLine=!1:state.currentIndent++,"proc"==matched[0]||"fun"==matched[0]?state.tokenize=tokenFunProc:"class"==matched[0]?state.tokenize=tokenClass:"meth"==matched[0]&&(state.tokenize=tokenMeth),"keyword";// Middle and other keywords
if(stream.match(middleKeywords)||stream.match(commonKeywords))return"keyword";// End keywords
if(stream.match(endKeywords))return state.currentIndent--,"keyword";// Eat the next char for next comparisons
var ch=stream.next();// Strings
if("\""==ch||"'"==ch)return state.tokenize=tokenString(ch),state.tokenize(stream,state);// Numbers
if(/[~\d]/.test(ch)){if("~"==ch){if(!/^[0-9]/.test(stream.peek()))return null;if("0"==stream.next()&&stream.match(/^[xX][0-9a-fA-F]+/)||stream.match(/^[0-9]*(\.[0-9]+)?([eE][~+]?[0-9]+)?/))return"number"}return"0"==ch&&stream.match(/^[xX][0-9a-fA-F]+/)||stream.match(/^[0-9]*(\.[0-9]+)?([eE][~+]?[0-9]+)?/)?"number":null}// Comments
return"%"==ch?(stream.skipToEnd(),"comment"):"/"==ch&&stream.eat("*")?(state.tokenize=tokenComment,tokenComment(stream,state)):singleOperators.test(ch)?"operator":(stream.eatWhile(/\w/),"variable");// Single operators
// If nothing match, we skip the entire alphanumerical block
}function tokenClass(stream,state){return stream.eatSpace()?null:(stream.match(/([A-Z][A-Za-z0-9_]*)|(`.+`)/),state.tokenize=tokenBase,"type")}function tokenMeth(stream,state){return stream.eatSpace()?null:(stream.match(/([a-zA-Z][A-Za-z0-9_]*)|(`.+`)/),state.tokenize=tokenBase,"def")}function tokenFunProc(stream,state){return stream.eatSpace()?null:!state.hasPassedFirstStage&&stream.eat("{")?(state.hasPassedFirstStage=!0,"bracket"):state.hasPassedFirstStage?(stream.match(/([A-Z][A-Za-z0-9_]*)|(`.+`)|\$/),state.hasPassedFirstStage=!1,state.tokenize=tokenBase,"def"):(state.tokenize=tokenBase,null)}function tokenComment(stream,state){for(var ch,maybeEnd=!1;ch=stream.next();){if("/"==ch&&maybeEnd){state.tokenize=tokenBase;break}maybeEnd="*"==ch}return"comment"}function tokenString(quote){return function(stream,state){for(var next,escaped=!1;null!=(next=stream.next());){if(next==quote&&!escaped){break}escaped=!escaped&&"\\"==next}return state.tokenize=tokenBase,"string"}}Object.defineProperty(exports,"__esModule",{value:!0});var singleOperators=/[\^@!\|<>#~\.\*\-\+\\/,=]/,doubleOperators=/(<-)|(:=)|(=<)|(>=)|(<=)|(<:)|(>:)|(=:)|(\\=)|(\\=:)|(!!)|(==)|(::)/,tripleOperators=/(:::)|(\.\.\.)|(=<:)|(>=:)/,middle=["in","then","else","of","elseof","elsecase","elseif","catch","finally","with","require","prepare","import","export","define","do"],end=["end"],atoms=wordRegexp(["true","false","nil","unit"]),commonKeywords=wordRegexp(["andthen","at","attr","declare","feat","from","lex","mod","div","mode","orelse","parser","prod","prop","scanner","self","syn","token"]),openingKeywords=wordRegexp(["local","proc","fun","case","class","if","cond","or","dis","choice","not","thread","try","raise","lock","for","suchthat","meth","functor"]),middleKeywords=wordRegexp(middle),endKeywords=wordRegexp(end);const oz={startState:function(){return{tokenize:tokenBase,currentIndent:0,doInCurrentLine:!1,hasPassedFirstStage:!1}},token:function(stream,state){return stream.sol()&&(state.doInCurrentLine=0),state.tokenize(stream,state)},indent:function(state,textAfter,cx){var trueText=textAfter.replace(/^\s+|\s+$/g,"");return trueText.match(endKeywords)||trueText.match(middleKeywords)||trueText.match(/(\[])/)?cx.unit*(state.currentIndent-1):0>state.currentIndent?0:state.currentIndent*cx.unit},languageData:{indentOnInut:function(){// Reindentation should occur on [] or on a match of any of
// the block closing keywords, at the end of a line.
var allClosings=middle.concat(end);return new RegExp("[\\[\\]]|("+allClosings.join("|")+")$")}(),commentTokens:{line:"%",block:{open:"/*",close:"*/"}}}};return exports.oz=oz,exports}